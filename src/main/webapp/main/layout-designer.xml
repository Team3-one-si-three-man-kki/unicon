<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
            <w2:dataCollection baseNode="map"/>
            <w2:workflowCollection/>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <script lazy="false" type="text/javascript"><![CDATA[scwin.onpageload = function() {

};

// 드래그 상태 변수들
var isDragging = false;
var draggedModuleId = null;

// 마우스 다운 - 드래그 시작
scwin.module_mouseDown = function(e, comp) {
    isDragging = true;
    draggedModuleId = this.id || "mf_grp_chatModule";
    
    console.log("드래그 시작:", draggedModuleId);
    
    // 기본 선택 동작 방지 (영역 드래그 잡히는거 방지)
    if (e.preventDefault) e.preventDefault();
    if (e.stopPropagation) e.stopPropagation();
    
    // 전체 문서에서 텍스트 선택 방지
    document.body.style.userSelect = 'none';
    document.body.style.webkitUserSelect = 'none';
    document.body.style.mozUserSelect = 'none';
    document.body.style.msUserSelect = 'none';
    
    // 드래그 중 커서 변경
    document.body.style.cursor = 'grabbing';
    
    // 전체 문서에 마우스 이벤트 추가
    document.addEventListener('mousemove', scwin.global_mouseMove);
    document.addEventListener('mouseup', scwin.global_mouseUp);
    
    return false; // 기본 동작 차단
};

// 전체 화면에서 마우스 무브
scwin.global_mouseMove = function(e) {
    if (!isDragging) return;
    
    console.log("전체 드래그 중.. -> 위치:", e.clientX, e.clientY);
    
    // **************여기에 드래그 중인 시각적 요소 추가 해야함********
    // 마우스 커서 따라다니는 모듈 미리보기
};

// 전체 화면에서 마우스 업
scwin.global_mouseUp = function(e) {
    if (!isDragging) return;
    
    console.log("전체 드래그 종료:", e.clientX, e.clientY);
    
    // 드롭 영역 체크
    scwin.checkDropZone(e.clientX, e.clientY);
    
    // 드래그 상태 초기화
    isDragging = false;
    draggedModuleId = null;
    
    // 텍스트 선택 제한 해제
    document.body.style.userSelect = '';
    //document.body.style.webkitUserSelect = '';
    document.body.style.mozUserSelect = '';
    document.body.style.msUserSelect = '';
    
    // 원래 기본 커서로 복원
    document.body.style.cursor = 'default';
    
    // 전체 문서 이벤트 제거
    document.removeEventListener('mousemove', scwin.global_mouseMove);
    document.removeEventListener('mouseup', scwin.global_mouseUp);
};

// 영역에 모듈 정보 표시하는 함수
scwin.displayModuleInArea = function(zoneId, moduleId){
    // 영역 정보 가져오기
    var areaComponent = $p.getComponentById(zoneId);
    if(!areaComponent){
        console.log("영역을 찾을 수 없습니다: ", zoneId);
        return;
    }

    // 모듈 정보 가져오기
    var moduleInfo = scwin.getModuleData(moduleId);
    console.log("배치하는 모듈 정보:", moduleInfo);

    // 드롭한 영역을 모듈의 내용으로 변경
    var areaElement = document.getElementById(zoneId);
    if(areaElement){
        // 스타일 변경
        areaElement.style.border = "2px solid #4CAF50";
        areaElement.style.background = "#f0f8f0";

        // 라벨 값 변경
        var labelElement = areaElement.querySelector('span');
        if(labelElement){
            labelElement.innerHTML = moduleInfo.icon + " " +moduleInfo.name;
        }
    }
};

// 모듈 데이터 가져오기 함수 -> 나중에 동적으로 모듈 데이터 받아오기
// 아이콘을 직접 넣지말고 유니코드로 넣기!
scwin.getModuleData = function(moduleId) {
    var moduleData = {
        "mf_grp_chatModule": {
            icon: "\uD83D\uDCAC",
            name: "채팅", 
            desc: "실시간 메시징"
        },
        "mf_grp_videoModule": {
            icon: "\uD83D\uDCF9",
            name: "화상회의",
            desc: "WebRTC 영상통화"
        }
    };
    
    return moduleData[moduleId] || {icon: "", name: "알 수 없음", desc: "모듈 정보 없음"};
};

// 드롭 처리 함수
scwin.handleDrop = function(zoneId) {
    console.log("드롭 처리 시작 - 영역:", zoneId, "모듈:", draggedModuleId);
    
    // 영역별로 처리 - mf_ 접두사 추가  ---> 디버그 로그이므로 나중에 빼거나 모달같은걸로 변경.
    switch (zoneId) {
        case "mf_grp_area1":
            alert("영역 1에 " + draggedModuleId + " 모듈이 배치되었습니다!");
            break;
        case "mf_grp_area2":
            alert("영역 2에 " + draggedModuleId + " 모듈이 배치되었습니다!");
            break;
        case "mf_grp_area3":
            alert("영역 3에 " + draggedModuleId + " 모듈이 배치되었습니다!");
            break;
        case "mf_grp_area4":
            alert("영역 4에 " + draggedModuleId + " 모듈이 배치되었습니다!");
            break;
        default:
            console.log("알 수 없는 영역:", zoneId);
    }

    // 드롭하면 해당영역에 모듈 정보 표시
    scwin.displayModuleInArea(zoneId, draggedModuleId);
};

// 드롭 영역 체크 함수
scwin.checkDropZone = function(x, y) {
    console.log("드롭 위치 체크:", x, y, "모듈:", draggedModuleId);
    
    // 마우스 위치에서 실제 요소 찾기
    var elementAtPosition = document.elementFromPoint(x, y);
    
    if (!elementAtPosition) {
        console.log("드롭 실패: 요소를 찾을 수 없음");
        return;
    }
    
    // 디버깅: 첫 번째 요소 정보 출력
    // console.log("첫 번째 감지된 요소:", {
    //     tagName: elementAtPosition.tagName,
    //     id: elementAtPosition.id,
    //     className: elementAtPosition.className
    
    // 드롭 영역 찾기 (상위로 올라가면서 grp_area로 시작하는 요소 찾기)
    var dropZoneElement = scwin.findDropZoneElement(elementAtPosition);
    
    if (dropZoneElement) {
        var zoneId = dropZoneElement.id;
        console.log("드롭 성공! 영역:", zoneId);
        
        // 영역별 처리
        scwin.handleDrop(zoneId);
    } else {
        console.log("드롭 실패: 유효한 영역이 아님");
    }
};

// 드롭 영역 요소 찾기 함수
scwin.findDropZoneElement = function(element) {
    // 영역1~4의 ID 목록 - mf_ 접두사 추가
    var validDropZones = ["mf_grp_area1", "mf_grp_area2", "mf_grp_area3", "mf_grp_area4"];
    
    // 현재 요소부터 상위로 올라가면서 체크
    var currentElement = element;
    var stepCount = 0;
    
    //console.log("=== 드롭 영역 찾기 시작 ===");
    
    while (currentElement && currentElement !== document.body && stepCount < 10) {
        stepCount++;
        
        // console.log("단계 " + stepCount + ":", {
        //     tagName: currentElement.tagName,
        //     id: currentElement.id,
        //     className: currentElement.className
        // });
        
        // 현재 드롭한 영역 요소의 ID가 유효한 드롭 영역인지 체크
        for (var i = 0; i < validDropZones.length; i++) {
            if (currentElement.id === validDropZones[i]) {
                console.log("유효 드롭 영역 발견:", currentElement.id);
                return currentElement;
            }
        }
        
        // 상위 요소로 이동
        currentElement = currentElement.parentElement;
    }
    
    console.log("=== 드롭 영역 찾기 실패 ===");
    return null; // -> 유효한 드롭 영역을 찾지 못한 경우
};

]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
    	<xf:group class="sub_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true" meta_snippetName="0_01 페이지시작"
    		style="">
    		<xf:group class="pgtbox" id="" meta_snippetCategory="02_타이틀" meta_snippetKeyComponent="true" meta_snippetName="2_01 페이지타이틀"
    			style="width:100%;height:60px;background:#667eea;color:white;font-size:18px;text-align:center;">
    			<w2:textbox class="pgt_tit" id="tb_title" label="UI 배치 설정" style="" tagname=""></w2:textbox>
    			<xf:group class="breadcrumb" id="" style="">
    				<xf:group id="" style="" tagname="ul">
    					<xf:group class="home" id="" style="" tagname="li">
    						<w2:anchor id="" outerDiv="false" style="">
    							<xf:label><![CDATA[Home]]></xf:label>
    						</w2:anchor>
    					</xf:group>
    					<xf:group id="" style="" tagname="li">
    						<w2:anchor id="" outerDiv="false" style="">
    							<xf:label><![CDATA[1Depth Menu]]></xf:label>
    						</w2:anchor>
    					</xf:group>
    					<xf:group id="" style="" tagname="li">
    						<w2:anchor id="" outerDiv="false" style="">
    							<xf:label><![CDATA[2Depth Menu]]></xf:label>
    						</w2:anchor>
    					</xf:group>
    					<xf:group id="" style="" tagname="li">
    						<w2:span id="" label="3Depth Menu" style=""></w2:span>
    					</xf:group>
    				</xf:group>
    			</xf:group>
    			<xf:trigger class="btn_fav" id="" style="" type="button">
    				<xf:label></xf:label>
    			</xf:trigger>
    		</xf:group>
    		<xf:group style="width:100%;height:171.20%;border:1px solid #ddd;" id="grp_main">
    			<xf:group style="width:350px;height:500px;background:#f8f9fa;padding:5px;float:left;" id="grp_sidebar">
    				<xf:group class="titbox" id="" meta_snippetCategory="02_타이틀" meta_snippetKeyComponent="true"
    					meta_snippetName="2_03 서브타이틀(h4)" style="width:100%;font-weight:bold;margin-bottom:10px;">
    					<w2:textbox class="" id="" label="사용 가능한 모듈" style="font-size: 20px" tagname="h4"></w2:textbox>
    				</xf:group>
    				<xf:group
    					style="width:90%;background:white;border:2px solid #4CAF50;border-radius:8px;padding:10px;margin:5px auto;cursor:pointer;"
    					id="grp_chatModule" ev:onmousedown="scwin.module_mouseDown" ev:onmousemove="scwin.global_mouseMove" ev:onmouseup="scwin.global_mouseUp">
    					<w2:span id="tb_chatIcon" label="💬" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    						meta_snippetName="10_16 출력텍스트" style="width:100%;text-align:center;font-size:24px;margin-bottom:8px;display:block;">
    					</w2:span>
    					<w2:span id="tb_chatName" label="채팅" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    						meta_snippetName="10_16 출력텍스트" style="width:100%;text-align:center;font-weight:bold;margin-bottom:4px;display:block;">
    					</w2:span>
    					<w2:span id="tb_chatDesc" label="실시간 메시징" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    						meta_snippetName="10_16 출력텍스트" style="width:100%;text-align:center;font-size:12px;color:#666;display:block;">
    					</w2:span>
    				</xf:group>
    				<xf:group
    					style="width:90%;background:white;border:2px solid #4CAF50;border-radius:8px;padding:10px;margin:5px auto;cursor:pointer;"
    					id="grp_videoModule" ev:onmousedown="scwin.module_mouseDown" ev:onmousemove="scwin.global_mouseMove" ev:onmouseup="scwin.global_mouseUp">
    					<w2:span id="tb_videoIcon" label="📹" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    						meta_snippetName="10_16 출력텍스트" style="width:100%;text-align:center;font-size:24px;margin-bottom:8px;display:block;">
    					</w2:span>
    					<w2:span id="tb_videoName" label="화상회의" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    						meta_snippetName="10_16 출력텍스트" style="width:100%;text-align:center;font-weight:bold;margin-bottom:4px;display:block;">
    					</w2:span>
    					<w2:span id="tb_videoDesc" label="WebRTC 영상통화" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    						meta_snippetName="10_16 출력텍스트" style="width:100%;text-align:center;font-size:12px;color:#666;display:block;">
    					</w2:span>
    				</xf:group>
    			</xf:group>
    			<xf:group style="width:NaN%;height:261.60%;background:#f0f2f5;padding:20px;margin-left:350px;" id="grp_canvasContainer">
    				<xf:group class="titbox" id="" meta_snippetCategory="02_타이틀" meta_snippetKeyComponent="true"
    					meta_snippetName="2_03 서브타이틀(h4)" style="">
    					<w2:textbox class="" id="" label="UI 배치화면" style="" tagname="h4"></w2:textbox>
    				</xf:group>
    				<xf:group
    					style="width:100%;height:100%;padding:20px;display:flex;flex-wrap:wrap;justify-content:space-around;align-content:flex-start;"
    					id="">
    					<xf:group
    						style="width:45%;height:150px;background:white;border:2px dashed #ddd;border-radius:8px;margin:2%;display:flex;align-items:center;justify-content:center;cursor:pointer;"
    						id="grp_area1">
    						<w2:span id="tb_area1Label" label="영역 1" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    							meta_snippetName="10_16 출력텍스트" style="color:#999;text-align:center;font-size:14px;">
    						</w2:span>
    					</xf:group>
    					<xf:group
    						style="width:45%;height:150px;background:white;border:2px dashed #ddd;border-radius:8px;margin:2%;display:flex;align-items:center;justify-content:center;cursor:pointer;"
    						id="grp_area2">
    						<w2:span id="tb_area2Label" label="영역 2" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    							meta_snippetName="10_16 출력텍스트" style="color:#999;text-align:center;font-size:14px;">
    						</w2:span>
    					</xf:group>
    					<xf:group
    						style="width:45%;height:150px;background:white;border:2px dashed #ddd;border-radius:8px;margin:2%;display:flex;align-items:center;justify-content:center;cursor:pointer;"
    						id="grp_area3">
    						<w2:span id="tb_area3Label" label="영역 3" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    							meta_snippetName="10_16 출력텍스트" style="color:#999;text-align:center;font-size:14px;">
    						</w2:span>
    					</xf:group>
    					<xf:group
    						style="width:45%;height:150px;background:white;border:2px dashed #ddd;border-radius:8px;margin:2%;display:flex;align-items:center;justify-content:center;cursor:pointer;"
    						id="grp_area4">
    						<w2:span id="tb_area4Label" label="영역 4" meta_snippetCategory="10_입력폼" meta_snippetKeyComponent="true"
    							meta_snippetName="10_16 출력텍스트" style="color:#999;text-align:center;font-size:14px;">
    						</w2:span>
    					</xf:group>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    	</xf:group>
    </body>
</html>
